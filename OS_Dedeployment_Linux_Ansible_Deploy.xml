<?xml version="1.0"?>
<DeploymentFlow Template="true" ID="TODO: Use MakeInstance to to specify this" Name="TODO: Use MakeInstance to to specify this" LogPath="TODO: Use MakeInstance to to specify this">
	<Deployment Location="Public cloud">
		<Phase Description="Rescue DNS deployment">
			<GlobalValues>
				<EnvironmentSetting Name="UseDip" Value="false" />
			</GlobalValues>
			<Action Description="Create (temp) release folder" Idempotent="true" MaxRetries="2">
				<WorkingDir>%_RDToolsRoot%</WorkingDir>
				<Command>%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe</Command>
				<Arguments>New-Item -Path %TEMP%\release_%DeploymentEnvironment%_%DeploymentRole%_%BuildNumber% -ItemType Directory -Force</Arguments>
			</Action>
			<Action Description="Copy release folder" Idempotent="true" MaxRetries="2">
				<WorkingDir>%_RDToolsRoot%</WorkingDir>
				<Command>%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe</Command>
				<Arguments>Copy-Item -Path %df_BuildPath%\%df_FQBN%\%BuildPathSuffix%* -Destination %TEMP%\release_%DeploymentEnvironment%_%DeploymentRole%_%BuildNumber% -Recurse -Force</Arguments>
			</Action>
			<Action Description="Run deploy script" Idempotent="true" MaxRetries="1">
				<WorkingDir>%_RDToolsRoot%</WorkingDir>
				<Command>%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe</Command>
				<Arguments>-ExecutionPolicy Bypass %TEMP%\release_%DeploymentEnvironment%_%DeploymentRole%_%BuildNumber%\scripts\deploy_via_ansible.ps1 -WorkFolder %TEMP%\deploy_%DeploymentEnvironment%_%DeploymentRole%_%BuildNumber% -AnsibleBuildArtifacts %df_BuildPath%\%df_FQBN%\%BuildPathSuffix% -RescueBuildArtifacts %Rescue_RootPath%\%BuildNumber%\retail-amd64\rescue -Action 'kernelUpdate' -Env %DeploymentEnvironment% -Role %DeploymentRole% -Stage %DeploymentStage% -InventoryLimitParam '%InventoryLimitParam%' -Inventory '%Inventory%' -MaxFailureAllowedPercentage %MaxFailureAllowedPercentage% -RollingUpdatePercentage %RollingUpdatePercentage% -KernelTargetVersion %KernelTargetVersion% -ExcludeServiceContainer -ExcludeMonitoring</Arguments>
			</Action>
			<Action Description="Clean up temp folders" Idempotent="true" MaxRetries="2">
				<WorkingDir>%_RDToolsRoot%</WorkingDir>
				<Command>%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe</Command>
				<Arguments>"Remove-Item -Recurse -Force %TEMP%\deploy_%DeploymentEnvironment%_%DeploymentRole%_%BuildNumber%,%TEMP%\release_%DeploymentEnvironment%_%DeploymentRole%_%BuildNumber% -ErrorAction SilentlyContinue"</Arguments>
			</Action>-->
		</Phase>
	</Deployment>
</DeploymentFlow>
